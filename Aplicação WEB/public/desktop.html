<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Área de Trabalho</title>
    <link rel="icon" href="images/windows-xp-icon.png">
    <link rel="stylesheet" href="css/style-desktop.css">
    <link rel="stylesheet" href="css/style-minesweeeper.css">
    <script src="js/script-desktop.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="area-trabalho">
        <div id="caixa-erro">
            <div id="barra-titulo-erro">
                <div id="erro-titulo">Bem-vindo ao Windows XP!</div>
            </div>
            <div id="conteudo">
                <div id="icone-erro">
                    <img src="images/icones/Speech.png" id="icone" draggable="false">
                    <a id="erro">Login realizado com sucesso.</a>
                    <audio id="aviso" src="sounds/Windows XP Exclamation.mp3" preload="auto"></audio>
                    <audio id="informativo" src="sounds/Windows XP Balloon.mp3" preload="auto"></audio>
                    <audio id="entrar" src="sounds/Windows XP Startup.mp3"></audio>
                </div>
                <div id="botoes">
                    <button id="btnAviso" onclick="fecharAvisoInicial()">Ok</button>
                    <button id="btnFecharAviso" onclick="fecharAviso()" hidden>Não</button>
                </div>
            </div>
        </div>
        <div id="aplicativos">
            <div class="icone" tabindex="-1" ondblclick="abrirCampoMinado()">
                <img src="images/icones/Minesweeper.png" draggable="false">
                <span><p>Campo Minado</p></span>
            </div>
            <div class="icone" tabindex="-1">
                <img src="images/icones/Internet Explorer 6.png" draggable="false">
                <p>Internet Explorer</p>
            </div>
        </div>
        <div id="janela-campo-minado">
            <div id="barra-titulo">
                <div id="titulo">
                    <img src="images/icones/Minesweeper.png" draggable="false">
                    <a>Campo Minado</a>
                </div>
                <div id="controles">
                    <img id="minimizar" src="images/icones/Minimize.png" draggable="false" onclick="minimizarCampoMinado()">
                    <img id="fechar" src="images/icones/Exit.png" draggable="false" onclick="fecharCampoMinado()">
                </div>
            </div>
            <div id="conteudo">
                <div id="menu-principal">
                    <div id="titulo">
                        <img id="imgA" src="images/campo-minado/happy-face.png" draggable="false">
                        <h1>CAMPO MINADO</h1>
                        <img id="imgB" src="images/campo-minado/dead-face.png" draggable="false">
                    </div>
                    <div id="opcoes">
                        <span onclick="jogar()">JOGAR</span>
                        <span onclick="placarLideres()">PLACAR DE LÍDERES</span>
                    </div>
                </div>
                <div id="placar-lideres">
                    <div id="ranking">
                        <span>TOP 5 PONTUAÇÕES</span>
                        <p>USUÁRIO - PONTOS - TEMPO</p>
                        <div id="top-5">
                        </div>
                        <a onclick="voltar()">VOLTAR</a>
                    </div>
                    <div id="grafico-kpi">
                        <div id="grafico">
                            <canvas id="maiores-vencedores"></canvas>
                        </div>
                        <div id="kpi">
                            <span>MENOR TEMPO ATUAL</span>
                            <a id="usuario-melhor-tempo">lrobatino</a>
                            <p id="melhor-tempo">13s</p>
                        </div>
                    </div>
                </div>
                <div id="opcoes-jogo">
                    <div id="pontuacao-timer">
                        <div class="contador" id="pontuacao">
                            <img id="digit1" src="images/campo-minado/t0.png" draggable="false">
                            <img id="digit2" src="images/campo-minado/t0.png" draggable="false">
                            <img id="digit3" src="images/campo-minado/t0.png" draggable="false">
                        </div>
                        <div class="contador" id="timer">
                            <img id="sDigit1" src="images/campo-minado/t0.png" draggable="false">
                            <img id="sDigit2" src="images/campo-minado/t0.png" draggable="false">
                            <img id="sDigit3" src="images/campo-minado/t0.png" draggable="false">
                        </div>
                    </div>
                    <div id="emote">
                        <img id="face" src="images/campo-minado/happy-face.png" draggable="false">
                    </div>
                    <p onclick="reiniciar()">REINICIAR</p>
                    <p onclick="voltar()">VOLTAR</p>
                </div>
                <canvas id="jogo" width="510" height="510"></canvas>
            </div>
        </div>
    </div>
    <div id="menu">
        <div id="cabecalho">
            <img src="" id="avatar" draggable="false">
            <p id="usuario"></p>
        </div>
        <div id="conteudo">

        </div>
        <div id="rodape">
            <div id="sair" onclick="sair()">
                <img src="images/icones/Logout.png" draggable="false">
                <a>Sair</a>
            </div>
        </div>
    </div>
    <div id="barra-tarefa">
        <div id="iniciar" onclick="abrirMenu()">
            <img src="images/windows-xp-icon-sombra.png" draggable="false">
            <b>menu</b>
        </div>
        <div id="tarefas">
        </div>
        <div id="indicador-sistema">
            <a id="data-hora"></a>
        </div>
    </div>
</body>
</html>

<script src="js/script-minesweeper.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

<script>

    const maiorVencedor = [];
    const qtdVitorias = [];

    function buscarMaioresVencedores() {
    fetch('/score/buscarMaioresVencedores', {
        method: 'GET',
        headers: { 'Content-Type': 'application/json' }
    })
        .then(response => {
            if (!response.ok) {
                throw new Error(`Erro na requisição: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('Maiores vencedores recebidos:', data);

            maiorVencedor.length = 0;
            qtdVitorias.length = 0;

            data.forEach(item => {
                const index = maiorVencedor.indexOf(item.usuario);

                if (index !== -1) {
                    qtdVitorias[index] = item.qtdVitorias;
                } else {
                    maiorVencedor.push(item.usuario);
                    qtdVitorias.push(item.qtdVitorias);
                }
            });

            criarGrafico();
        })
        .catch(err => {
            console.error('Erro ao buscar maiores vencedores:', err);
        });
    }


    let graficoGerado = null;

    function criarGrafico() {
        Chart.register(ChartDataLabels);

        const ctxGrafico = document.getElementById('maiores-vencedores').getContext('2d');

        if (graficoGerado) {
        graficoGerado.destroy();
        }

        graficoGerado = new Chart(ctxGrafico, {
            type: 'bar',
            data: {
                labels: maiorVencedor,
                datasets: [{
                    data: qtdVitorias,
                    borderWidth: 1,
                    backgroundColor: [
                        'rgb(255, 55, 55)',
                        'rgb(255, 255, 55)',
                        'rgb(55, 255, 55)',
                        'rgb(55, 55, 255)',
                        'rgb(255, 55, 255)',
                    ],
                }]
            },
            options: {
                scales: {
                    x: {
                        ticks: {
                            font: {
                                size: 16,
                                family: 'Retro'
                            },
                            color: '#555555'
                        },
                        grid: {
                            display: false,
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            display: false,
                        },
                        grid: {
                            display: false,
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'MAIORES VENCEDORES',
                        font: {
                            size: 32,
                            family: 'Retro',
                        }
                    },
                    legend: {
                        display: false
                    },
                    datalabels: {
                        font: {
                            size: 32,
                            family: 'Retro'
                        },
                        color: '#555555'
                    }
                }
            }
        });
    }

</script>